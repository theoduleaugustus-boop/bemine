<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üíò Valentine</title>
  <style>
    :root{
      --bg1:#fff0f6; --bg2:#ffe0ee; --ink:#2b1b22;
      --pink:#ff2f78; --pink2:#ff6fa1;
      --card:#ffffffcc; --shadow: 0 18px 55px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;color:var(--ink)}
    html{scroll-behavior:smooth;}
    body{
      overflow-x:hidden;
      background:
        radial-gradient(1200px 800px at 20% 10%, var(--bg2), transparent 55%),
        radial-gradient(1000px 700px at 80% 20%, #ffeaf2, transparent 60%),
        linear-gradient(135deg, var(--bg1), #fff);
    }

    /* floating bg hearts */
    #bgHearts{position:fixed;inset:0;pointer-events:none;overflow:hidden;opacity:.24;z-index:0}
    .bg-heart{position:absolute;bottom:-10vh;font-size:18px;animation:floatUp linear infinite;opacity:.9}
    @keyframes floatUp{
      0%{transform:translateY(0) translateX(0) rotate(0deg);opacity:0}
      10%{opacity:.9}
      100%{transform:translateY(-120vh) translateX(20px) rotate(18deg);opacity:0}
    }

    .section{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      position:relative;
      z-index:1;
    }

    .card{
      width:min(620px,94vw);
      background:var(--card);
      border:1px solid rgba(255,255,255,.6);
      border-radius:24px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
      padding:26px 22px 20px;
      text-align:center;
      position:relative;
    }
    .chip{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 14px;background:#fff;border-radius:999px;
      box-shadow:0 10px 30px rgba(0,0,0,.08);
      font-weight:1000;
    }
    h1{margin:14px 0 8px;font-size:clamp(22px,3.2vw,34px);letter-spacing:-.02em}
    p{margin:0 0 16px;opacity:.85}

    .toast{
      min-height:40px;
      margin:12px 0 22px;
      padding:0 6px;
      position:relative;
      z-index:1;
      font-weight:900;
    }

    .row{
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      position:relative;
      z-index:2;
      padding-top:8px;
      /* IMPORTANT: keep NO inside this box */
      width: fit-content;
      margin: 0 auto;
    }
    /* when dodging starts, create a ‚Äúplay area‚Äù inside the row */
    .row.dodge{
      width: min(520px, 92vw);
      height: 92px;
      justify-content:center;
      align-items:center;
    }

    button{
      border:0;border-radius:16px;padding:14px 18px;font-size:18px;cursor:pointer;
      transition:transform .15s ease, filter .15s ease, opacity .25s ease;
      user-select:none;-webkit-tap-highlight-color:transparent;
      box-shadow:0 12px 30px rgba(0,0,0,.10);
      min-width:170px;
      font-weight:1000;
    }
    #yesBtn{
      background:linear-gradient(90deg,var(--pink),var(--pink2));
      color:#fff;
      transform-origin:center bottom;
      position:relative;
      z-index:2;
    }
    #noBtn{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      color:#222;
      position:relative;
      z-index:1;
    }
    button:active{transform:scale(.98)}
    .hidden{opacity:0;pointer-events:none}

    /* YES heart beat */
    #yesHeart{
      display:inline-block;margin-left:6px;
      transform-origin:center;
      animation:heartBeat 1.2s ease-in-out infinite;
    }
    @keyframes heartBeat{
      0%,100%{transform:scale(1)}
      50%{transform:scale(1.25)}
    }

    /* NO stays INSIDE row when dodging */
    #noBtn.runaway{
      position:absolute;     /* not fixed */
      z-index:5;
      pointer-events:auto;
    }

    /* hearts burst on YES */
    .pop-heart{
      position:fixed;font-size:20px;pointer-events:none;
      animation:popUp 1.35s ease-out forwards;
      z-index:9997;
    }
    @keyframes popUp{
      0%{transform:translateY(0) scale(0.8);opacity:0}
      20%{opacity:1}
      100%{transform:translateY(-120px) scale(1.35);opacity:0}
    }

    /* -------- Vinyl section -------- */
    .vinylWrap{
      width:min(720px,94vw);
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
    }
    .vinylTitle{
      font-weight:1000;
      font-size:20px;
      opacity:.95;
    }

    #vinylCase{
      width:240px;
      height:160px;
      border-radius:18px;
      background:linear-gradient(135deg,#fff,#ffe6f1);
      border:2px solid rgba(0,0,0,.08);
      box-shadow:0 18px 40px rgba(0,0,0,.18);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:6px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      position:relative;
      overflow:hidden;
    }
    #vinylCase .label{
      font-weight:1000;
      font-size:14px;
      padding:6px 10px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,.06);
    }
    #vinylCase .mini{
      font-size:12px;
      opacity:.8;
      font-weight:800;
    }

    #lid{
      position:absolute;left:0;top:0;width:100%;height:100%;
      transform-origin:left center;
      pointer-events:none;
    }
    #vinylCase.open #lid{ animation: lidOpen .35s ease forwards; }
    @keyframes lidOpen{ from{transform:rotateY(0deg)} to{transform:rotateY(-25deg)} }

    #record{
      width:86px;height:86px;border-radius:50%;
      background: radial-gradient(circle at 50% 50%, #000 0 18%, #222 18% 34%, #111 34% 52%, #000 52% 100%);
      box-shadow: inset 0 0 0 4px rgba(255,255,255,.06);
      position:absolute; right:18px; top:38px;
      opacity:0;
      transform: translateX(-24px) scale(.95);
      transition: opacity .25s ease, transform .35s ease;
    }
    #record::after{
      content:"";
      position:absolute; inset:34px; border-radius:50%;
      background:linear-gradient(90deg,var(--pink),var(--pink2));
      box-shadow:0 0 0 3px rgba(255,255,255,.15);
    }
    #vinylCase.open #record{ opacity:1; transform: translateX(0) scale(1); }
    #record.spin{ animation: spin 1.05s linear infinite; }
    @keyframes spin{
      from{ transform: translateX(0) scale(1) rotate(0deg); }
      to{ transform: translateX(0) scale(1) rotate(360deg); }
    }

    .note{
      position:fixed;
      z-index:9200;
      font-size:18px;
      pointer-events:none;
      animation:noteFloat 2.2s ease-in forwards;
      opacity:.95;
    }
    @keyframes noteFloat{
      0%{transform:translateY(0) translateX(0) scale(.9);opacity:0}
      15%{opacity:1}
      100%{transform:translateY(-160px) translateX(var(--dx)) scale(1.2);opacity:0}
    }
  </style>
</head>
<body>
  <div id="bgHearts"></div>

  <!-- PAGE 1 -->
  <section class="section" id="page1">
    <div class="card">
      <div class="chip">üíò To the love of my life Sherkima</div>
      <h1>Will you be my Valentine?</h1>
      <p>I‚Äôm asking nicely‚Ä¶ but the buttons might disagree üòå</p>

      <div class="toast" id="toast"></div>

      <div class="row" id="btnRow">
        <button id="yesBtn">YES <span id="yesHeart">üíù</span></button>
        <button id="noBtn">No üôÉ</button>
      </div>
    </div>
  </section>

  <!-- PAGE 2 -->
  <section class="section" id="page2">
    <div class="vinylWrap">
      <div class="vinylTitle">One more thing‚Ä¶ üòåüé∂</div>
      <div id="vinylCase" role="button" aria-label="Vinyl surprise">
        <div class="label" id="vinylLabel">üéÅ Click me for a surprise</div>
        <div class="mini" id="vinylMini">I promise it‚Äôs cute.</div>
        <div id="lid" aria-hidden="true"></div>
        <div id="record" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- audio file in repo root -->
  <audio id="audio" preload="auto">
    <source src="song.m4a" type="audio/mp4">
  </audio>

<script>
  // bg hearts
  const bgHearts = document.getElementById("bgHearts");
  const heartChars = ["üíó","üíñ","üíû","üíï","üíò"];
  function spawnBgHeart(){
    const h = document.createElement("div");
    h.className = "bg-heart";
    h.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
    h.style.left = (Math.random()*100) + "vw";
    const dur = 10 + Math.random()*10;
    h.style.animationDuration = dur + "s";
    h.style.animationDelay = (-Math.random()*dur) + "s";
    h.style.fontSize = (14 + Math.random()*18) + "px";
    bgHearts.appendChild(h);
    setTimeout(()=>h.remove(), dur*1000);
  }
  for(let i=0;i<14;i++) spawnBgHeart();
  setInterval(spawnBgHeart, 900);

  const toast = document.getElementById("toast");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn  = document.getElementById("noBtn");
  const yesHeart = document.getElementById("yesHeart");
  const btnRow = document.getElementById("btnRow");

  const vinylCase = document.getElementById("vinylCase");
  const vinylLabel = document.getElementById("vinylLabel");
  const vinylMini = document.getElementById("vinylMini");
  const record = document.getElementById("record");
  const audioEl = document.getElementById("audio");

  const noTexts = [
    "Wrong button üòå",
    "Try again, love.",
    "‚ÄòNO‚Äô is running away maybe try ‚ÄòYES‚Äô?‚Ä¶",
    "You still was able to click no wow I‚Äôm impressed",
    "I think your finger slipped this time. It happens.",
    "Plot twist: No decided to find its own valentine"
  ];
  let noCount = 0;
  const NO_LIMIT = 6;

  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  // YES updates
  function updateYesEffects(){
    const scale = 1 + (noCount * 0.14);
    yesBtn.style.transform = `scale(${scale})`;
    const duration = Math.max(0.30, 1.2 - (noCount * 0.18)); // faster speed-up
    yesHeart.style.animationDuration = duration + "s";
  }

  function burstHeartsFrom(el){
    const rect = el.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    for(let i=0;i<10;i++){
      const h = document.createElement("div");
      h.className = "pop-heart";
      h.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
      h.style.left = (cx + (Math.random()*120-60)) + "px";
      h.style.top  = (cy + (Math.random()*30)) + "px";
      document.body.appendChild(h);
      setTimeout(()=>h.remove(), 1350);
    }
  }

  // ---------- NO stays inside row ----------
  let dodgeEnabled = false;
  let noX = 0, noY = 0;
  let vx = 0, vy = 0;
  let rafId = null;
  let mouseX = 0, mouseY = 0;

  function initNoAbsoluteInRow(){
    // captures starting position next to YES and keeps it there until dodgeEnabled flips
    const rr = btnRow.getBoundingClientRect();
    const nr = noBtn.getBoundingClientRect();
    noX = nr.left - rr.left;
    noY = nr.top  - rr.top;
    noBtn.classList.add("runaway");
    noBtn.style.left = noX + "px";
    noBtn.style.top  = noY + "px";
  }

  function setNoPosInRow(x, y){
    const w = noBtn.offsetWidth || 170;
    const h = noBtn.offsetHeight || 56;
    const pad = 6;
    const maxX = btnRow.clientWidth  - w - pad;
    const maxY = btnRow.clientHeight - h - pad;
    noX = clamp(x, pad, Math.max(pad, maxX));
    noY = clamp(y, pad, Math.max(pad, maxY));
    noBtn.style.left = noX + "px";
    noBtn.style.top  = noY + "px";
  }

  function startDodgeEngine(){
    if (rafId) return;
    const MAX_SPEED = 16;   // faster than before
    const FRICTION  = 0.82; // less friction = quicker movement
    const TRIGGER   = 175;  // runs away sooner
    const BOOST     = 1.25; // stronger push away

    function step(){
      if (noBtn.classList.contains("hidden")){
        rafId = null;
        return;
      }
      if (!dodgeEnabled){
        rafId = requestAnimationFrame(step);
        return;
      }

      const w = noBtn.offsetWidth || 170;
      const h = noBtn.offsetHeight || 56;

      // mouse position relative to row
      const rr = btnRow.getBoundingClientRect();
      const mx = mouseX - rr.left;
      const my = mouseY - rr.top;

      const bx = noX + w/2;
      const by = noY + h/2;
      const dx = bx - mx;
      const dy = by - my;
      const dist = Math.max(1, Math.hypot(dx, dy));

      if (dist < TRIGGER){
        const strength = (TRIGGER - dist) / TRIGGER; // 0..1
        const ux = dx / dist;
        const uy = dy / dist;
        vx += ux * (MAX_SPEED * strength * BOOST);
        vy += uy * (MAX_SPEED * strength * BOOST);
      }

      vx *= FRICTION;
      vy *= FRICTION;

      const vLen = Math.max(1, Math.hypot(vx, vy));
      if (vLen > MAX_SPEED){
        vx = (vx / vLen) * MAX_SPEED;
        vy = (vy / vLen) * MAX_SPEED;
      }

      setNoPosInRow(noX + vx, noY + vy);

      // gentle bounce on edges by flipping velocity when we hit bounds
      const pad = 6;
      const maxX = btnRow.clientWidth  - w - pad;
      const maxY = btnRow.clientHeight - h - pad;
      if (noX <= pad || noX >= maxX) vx *= -0.55;
      if (noY <= pad || noY >= maxY) vy *= -0.55;

      rafId = requestAnimationFrame(step);
    }
    rafId = requestAnimationFrame(step);
  }

  // Track mouse always (desktop)
  window.addEventListener("mousemove", (e)=>{
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  // Enable dodge ONLY after the first NO click or first hover attempt
  function enableDodge(){
    if (dodgeEnabled) return;
    dodgeEnabled = true;
    btnRow.classList.add("dodge");      // create a bounded play area
    initNoAbsoluteInRow();              // lock NO into row coordinates
    startDodgeEngine();
  }

  // Desktop: start dodging when the cursor gets close to the NO button
  noBtn.addEventListener("mouseenter", ()=>{
    enableDodge();
  });

  // Click NO: show text, grow YES, then dodge (and allow clicking up to 6 times)
  noBtn.addEventListener("click", ()=>{
    noCount++;
    toast.textContent = noTexts[Math.min(noCount-1, noTexts.length-1)];
    updateYesEffects();
    enableDodge();

    if (noCount >= NO_LIMIT){
      noBtn.classList.add("hidden");
    }
  });

  // YES click: hearts + scroll down
  yesBtn.addEventListener("click", ()=>{
    burstHeartsFrom(yesBtn);
    toast.textContent = "Yessss üòåüíó Smart choice. I knew you were my Valentine.";
    yesHeart.style.animation = "none";
    document.getElementById("page2").scrollIntoView({behavior:"smooth"});
  });

  // Vinyl: click -> remove label -> open -> slide + spin record -> notes + play song
  let notesTimer = null;
  function startNotes(){
    if (notesTimer) return;
    notesTimer = setInterval(()=>{
      const note = document.createElement("div");
      note.className = "note";
      note.textContent = ["‚ô™","‚ô´","‚ô¨","‚ô©"][Math.floor(Math.random()*4)];
      const r = vinylCase.getBoundingClientRect();
      note.style.left = (r.left + r.width/2 + (Math.random()*60-30)) + "px";
      note.style.top  = (r.top + 35 + (Math.random()*30)) + "px";
      note.style.setProperty("--dx", (Math.random()*100-50) + "px");
      document.body.appendChild(note);
      setTimeout(()=>note.remove(), 2200);
    }, 240);
  }

  vinylCase.addEventListener("click", async ()=>{
    vinylLabel.classList.add("hidden");
    vinylMini.classList.add("hidden");
    vinylCase.classList.add("open");
    record.classList.add("spin");
    startNotes();
    try{ await audioEl.play(); } catch(e){ /* ignore */ }
  });

  // Keep NO correctly bounded if the layout changes (rotation)
  window.addEventListener("resize", ()=>{
    if (!dodgeEnabled) return;
    // recalc bounds by clamping current position
    setNoPosInRow(noX, noY);
  });
</script>
</body>
</html>
