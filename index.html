<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Valentine ğŸ’˜</title>
  <style>
    :root{
      --pink:#ff4fa3;
      --pink2:#ff77b7;
      --rose:#ff2d55;
      --card:#ffffffcc;
      --text:#2a1630;
      --muted:#6b3a5a;
      --yes1:#ff4fa3;
      --yes2:#ff77b7;
      --no1:#ff6b8a;
      --no2:#ff9fb5;
      --shadow: 0 18px 50px rgba(255,79,163,.22);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 10% 10%, #ffd1e866, transparent 55%),
        radial-gradient(900px 600px at 90% 30%, #ffb4d466, transparent 60%),
        linear-gradient(180deg, #fff6fb, #ffe7f3);
      overflow:hidden;
    }

    body::after{
      content:"";
      position:fixed; inset:0;
      background: radial-gradient(1200px 700px at 50% 35%, transparent 55%, rgba(255,45,85,.08) 100%);
      pointer-events:none;
      z-index:1;
    }

    /* Ending tint layer */
    #tintLayer{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity .45s ease;
      z-index:2;
    }
    #tintLayer.on{ opacity:1; }

    #tintLayer.mode-commitment{
      background:
        radial-gradient(1100px 700px at 50% 35%, rgba(255,215,120,.30), transparent 60%),
        radial-gradient(900px 600px at 18% 18%, rgba(255,200,120,.18), transparent 55%),
        linear-gradient(180deg, rgba(255,245,230,.18), rgba(255,214,140,.10));
    }
    #tintLayer.mode-chaos{
      background:
        radial-gradient(900px 600px at 40% 25%, rgba(255,79,163,.22), transparent 58%),
        radial-gradient(900px 600px at 90% 40%, rgba(255,45,85,.16), transparent 60%),
        linear-gradient(180deg, rgba(255,246,251,.05), rgba(255,190,220,.12));
    }
    #tintLayer.mode-minigame{
      background:
        radial-gradient(900px 600px at 50% 25%, rgba(255,119,183,.18), transparent 60%),
        linear-gradient(180deg, rgba(255,246,251,.05), rgba(255,220,235,.12));
    }
    #tintLayer.mode-tease{
      background:
        radial-gradient(900px 600px at 50% 25%, rgba(255,45,85,.16), transparent 60%),
        radial-gradient(900px 600px at 15% 60%, rgba(107,58,90,.10), transparent 65%),
        linear-gradient(180deg, rgba(255,246,251,.03), rgba(255,200,225,.12));
    }
    #tintLayer.mode-destiny{
      background:
        radial-gradient(1100px 700px at 50% 35%, rgba(255,255,255,.42), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,240,248,.10));
    }

    body.legendary .wrap,
    body.legendary .bg{ filter: blur(0.8px); opacity:.96; }

    .bg{
      position:fixed; inset:0;
      overflow:hidden;
      pointer-events:none;
      z-index:0;
    }

    .sparkle{
      position:absolute;
      width:6px; height:6px;
      border-radius:50%;
      background: rgba(255,255,255,.85);
      box-shadow: 0 0 16px rgba(255,79,163,.25);
      opacity:0;
      animation: twinkle linear forwards;
    }
    @keyframes twinkle{
      0%{ transform: translate(var(--x), var(--y)) scale(.7); opacity:0; }
      20%{ opacity:.9; }
      60%{ opacity:.6; }
      100%{ transform: translate(var(--x), calc(var(--y) - 20vh)) scale(1.05); opacity:0; }
    }

    .float-heart{
      position:absolute;
      left:0; top:0;
      font-size:18px;
      opacity:.9;
      filter: drop-shadow(0 10px 14px rgba(255,79,163,.18));
      animation: rise linear forwards;
    }
    @keyframes rise{
      from{ transform: translate(var(--x), 110vh) scale(var(--s)); opacity:0; }
      10%{ opacity:.95; }
      to{ transform: translate(calc(var(--x) + var(--drift)), -15vh) scale(calc(var(--s) + .15)); opacity:0; }
    }

    .wrap{
      position:relative;
      height:100%;
      display:grid;
      place-items:center;
      padding:18px;
      z-index:3;
    }

    .card{
      width:min(680px, 100%);
      background:var(--card);
      border:1px solid rgba(255,79,163,.20);
      border-radius:26px;
      padding:22px 18px;
      box-shadow: var(--shadow);
      text-align:center;
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }

    .ribbon{
      position:absolute;
      inset:auto -30px -30px auto;
      width:180px; height:180px;
      background: radial-gradient(circle, rgba(255,79,163,.18), transparent 60%);
      transform: rotate(20deg);
      pointer-events:none;
    }

    h1{
      margin:6px 0 6px;
      font-size: clamp(22px, 4.6vw, 36px);
      letter-spacing:.2px;
      -webkit-user-select:none;
      user-select:none;
    }
    .question{
      margin:6px 0 10px;
      font-weight: 900;
      font-size: clamp(20px, 4.2vw, 30px);
      color: var(--text);
    }
    .subtitle{
      margin:0 0 16px;
      color:var(--muted);
      font-size: clamp(14px, 2.6vw, 16px);
      line-height:1.35;
    }

    .btn-zone{
      position:relative;
      width:min(520px, 100%);
      height:190px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:16px;
    }

    button{
      border:0;
      padding:14px 18px;
      border-radius:16px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      transition: transform .18s ease, filter .18s ease, opacity .25s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 14px 28px rgba(255,79,163,.18);
      position:relative;
      z-index:2;
    }
    button:active{ transform: scale(.98); }

    #yesBtn{
      background: linear-gradient(135deg, var(--yes1), var(--yes2));
      color:#fff;
      transform: scale(var(--yesScale, 1));
      white-space:nowrap;
    }

    .yesHeart{
      display:inline-block;
      width: 1.2em;
      text-align:center;
      margin-left:6px;
      transform-origin:center;
      animation: beat var(--beatSpeed, 1.8s) ease-in-out infinite;
    }
    @keyframes beat{
      0%, 100% { transform: scale(1); }
      25%      { transform: scale(var(--beatScale, 1.10)); }
      50%      { transform: scale(1); }
    }

    #noBtn{
      position:absolute;
      background: linear-gradient(135deg, var(--no1), var(--no2));
      color:#5b1630;
      box-shadow: 0 14px 28px rgba(255,107,138,.22);
      opacity: var(--noOpacity, 1);
      white-space:nowrap;
      z-index:3;
    }

    .toast{
      position:absolute;
      left:50%;
      top:10px;
      transform: translateX(-50%);
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(255,79,163,.18);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      font-size: 14px;
      color: #6b2c53;
      box-shadow: 0 14px 30px rgba(255,79,163,.18);
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index:5;
      white-space:nowrap;
      max-width: calc(100% - 24px);
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(4px);
    }

    .pop{
      position:fixed;
      font-size:18px;
      pointer-events:none;
      opacity:.95;
      animation: popUp .9s ease forwards;
      filter: drop-shadow(0 10px 14px rgba(255,79,163,.18));
      z-index:50;
    }
    @keyframes popUp{
      from{ transform: translateY(0) scale(.9); opacity:0; }
      20%{ opacity:1; }
      to{ transform: translateY(-60px) scale(1.12); opacity:0; }
    }

    /* Overlay */
    .overlay{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      background: rgba(255,246,251,.9);
      backdrop-filter: blur(8px);
      z-index:999;
      padding:18px;
    }
    .overlay.show{ display:grid; }

    .success{
      width:min(760px, 100%);
      border:1px solid rgba(255,79,163,.22);
      border-radius:26px;
      background:#ffffffd8;
      box-shadow: 0 25px 80px rgba(255,79,163,.25);
      padding:22px 18px 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }

    /* Destiny canvas behind card content */
    #destinyCanvas{
      position:absolute; inset:-20px;
      width:calc(100% + 40px);
      height:calc(100% + 40px);
      opacity:0;
      pointer-events:none;
      transition: opacity .35s ease;
      z-index:0;
    }
    .success.destinyOn #destinyCanvas{ opacity:1; }

    /* Legendary pulse */
    .legendPulse{
      position:absolute; inset:-10px;
      background: radial-gradient(circle at 50% 40%, rgba(255,220,140,.30), transparent 62%);
      opacity:0;
      pointer-events:none;
      z-index:0;
    }
    .success.legendOn .legendPulse{
      opacity:1;
      animation: glowPulse 1.2s ease-in-out infinite;
    }
    @keyframes glowPulse{
      0%,100%{ transform: scale(1); opacity:.55; }
      50%{ transform: scale(1.05); opacity:.85; }
    }

    /* Badge */
    .badge{
      position:absolute;
      left:14px; top:14px;
      padding:8px 10px;
      border-radius:999px;
      font-weight:950;
      font-size:12px;
      background: rgba(255,255,255,.70);
      border:1px solid rgba(255,79,163,.18);
      color:#6b2c53;
      display:none;
      z-index:3;
      backdrop-filter: blur(8px);
    }
    .badge.show{ display:inline-flex; align-items:center; gap:8px; }

    /* Chaos shake */
    .shake{
      animation: shake .35s ease-in-out 3;
    }
    @keyframes shake{
      0%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
      100%{ transform: translateX(0); }
    }

    .success h2{
      margin:8px 0 6px;
      font-size: clamp(26px, 5vw, 44px);
      position:relative;
      z-index:2;
    }
    .success p{
      margin:0 0 12px;
      color: rgba(107,58,90,.9);
      position:relative;
      z-index:2;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      justify-content:center;
      margin-top:10px;
      position:relative;
      z-index:2;
    }
    .btn2{
      background: linear-gradient(135deg, #60a5fa, #a78bfa);
      color:#09101f;
      font-weight:900;
    }
    .btn3{
      background: linear-gradient(135deg, #34d399, #a7f3d0);
      color:#062015;
      font-weight:900;
    }

    /* Confetti + stars + gold */
    .confetti{
      position:fixed;
      width:10px; height:16px;
      top:-20px;
      border-radius:4px;
      opacity:.95;
      pointer-events:none;
      animation: confFall linear forwards;
      z-index:1000;
    }
    @keyframes confFall{
      to{ transform: translateY(120vh) rotate(720deg); opacity:0.95; }
    }
    .star{
      position:fixed;
      top:-20px;
      font-size:14px;
      opacity:.9;
      pointer-events:none;
      animation: starFall linear forwards;
      z-index:1000;
      filter: drop-shadow(0 10px 14px rgba(255,255,255,.18));
    }
    @keyframes starFall{
      to{ transform: translateY(120vh) rotate(420deg); opacity:0.9; }
    }
    .gold{
      position:fixed;
      width:6px; height:6px;
      border-radius:50%;
      top: 105vh;
      opacity:.85;
      pointer-events:none;
      background: radial-gradient(circle, rgba(255,245,210,1), rgba(255,210,120,.85));
      box-shadow: 0 0 18px rgba(255,210,120,.22);
      animation: goldRise linear forwards;
      z-index:1100;
    }
    @keyframes goldRise{
      to{
        transform: translateY(-140vh) translateX(var(--dx)) scale(var(--s));
        opacity:0;
      }
    }

    /* Emoji rain (Chaos) */
    .emojiRain{
      position:fixed;
      top:-30px;
      font-size:20px;
      pointer-events:none;
      animation: emojiFall linear forwards;
      z-index:1200;
      filter: drop-shadow(0 10px 14px rgba(255,79,163,.18));
    }
    @keyframes emojiFall{
      to{ transform: translateY(120vh) rotate(360deg); opacity:0.95; }
    }

    /* Mini-game */
    #miniGame{ display:none; margin-top:10px; position:relative; z-index:2; }
    #heartArena{ position:relative; width:min(520px, 100%); height:180px; margin:0 auto; }
    .bar{
      width:min(520px, 100%);
      height:10px;
      margin:0 auto 10px;
      border-radius:999px;
      background: rgba(107,58,90,.12);
      overflow:hidden;
      border:1px solid rgba(255,79,163,.12);
    }
    .bar > div{
      height:100%;
      width:100%;
      transform-origin:left;
      background: linear-gradient(90deg, rgba(255,79,163,.85), rgba(255,183,214,.95));
      transform: scaleX(1);
    }
    .combo{
      font-weight:950;
      color:#6b2c53;
      margin-bottom:6px;
    }
    .gameHeart{
      position:absolute;
      font-size:36px;
      cursor:pointer;
      user-select:none;
      filter: drop-shadow(0 12px 14px rgba(255,79,163,.22));
      transform: scale(.9);
      animation: heartPop .18s ease-out forwards;
    }
    @keyframes heartPop{ to { transform: scale(1); } }
    .gameHeart.vanish{ animation: heartVanish .18s ease-in forwards; }
    @keyframes heartVanish{ to { transform: scale(.5); opacity:0; } }

    /* Tease cards */
    #teaseArea{ display:none; margin-top:10px; position:relative; z-index:2; }
    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      width:min(520px, 100%);
      margin: 8px auto 0;
    }
    .tCard{
      padding:14px 10px;
      border-radius:18px;
      border:1px solid rgba(255,79,163,.18);
      background: rgba(255,255,255,.70);
      font-weight:950;
      color:#6b2c53;
      cursor:pointer;
      box-shadow: 0 16px 40px rgba(255,79,163,.12);
      transition: transform .18s ease;
    }
    .tCard:active{ transform: scale(.98); }
    .tReveal{
      margin-top:10px;
      font-weight:900;
      color: rgba(107,58,90,.95);
    }

    /* Vinyl surprise */
    .surpriseWrap{ display:none; margin:10px auto 14px; width:min(560px, 100%); position:relative; z-index:2; }
    .surpriseWrap.show{ display:block; }

    .vinylScene{
      width:min(520px, 100%);
      margin: 10px auto 6px;
      position:relative;
      height:220px;
      display:grid;
      place-items:center;
    }
    .sleeve{
      width:260px; height:190px;
      border-radius:18px;
      background:
        linear-gradient(135deg, rgba(255,79,163,.16), rgba(255,183,214,.28)),
        radial-gradient(150px 120px at 20% 20%, rgba(255,255,255,.55), transparent 60%);
      border: 1px solid rgba(255,79,163,.22);
      box-shadow: 0 20px 60px rgba(255,79,163,.18);
      position:relative;
      overflow:hidden;
    }
    .sleeveLabel{
      position:absolute;
      left:16px; bottom:14px;
      font-weight:950;
      color: rgba(107,58,90,.85);
      font-size:14px;
      background: rgba(255,255,255,.62);
      border:1px solid rgba(255,79,163,.18);
      padding:8px 10px;
      border-radius:999px;
    }
    .record{
      width:170px; height:170px;
      border-radius:50%;
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%) translateX(-18px) translateY(-2px);
      background:
        radial-gradient(circle at 50% 50%, #fff 0 9px, transparent 10px),
        radial-gradient(circle at 50% 50%, #ffd1e8 0 32px, #ff8fc6 33px 100%),
        repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,.0) 0 3px, rgba(255,255,255,.22) 3px 6px);
      box-shadow: 0 16px 34px rgba(255,79,163,.20);
      opacity:0;
    }
    .record::after{
      content:"";
      position:absolute;
      inset:24px;
      border-radius:50%;
      background: radial-gradient(circle, #fff 0 18px, #ff4fa3 19px 62%, #ffb703 63% 100%);
      opacity:.85;
    }
    .surpriseWrap.show .record{
      animation: slideOut .85s ease forwards, spin 2.4s linear infinite .85s;
    }
    @keyframes slideOut{
      from{ opacity:0; transform: translate(-50%,-50%) translateX(-18px) translateY(-2px); }
      to{ opacity:1; transform: translate(-50%,-50%) translateX(92px) translateY(-2px); }
    }
    @keyframes spin {
      to { transform: translate(-50%,-50%) translateX(92px) translateY(-2px) rotate(360deg); }
    }
    .note{
      position:absolute;
      font-size:18px;
      opacity:0;
      filter: drop-shadow(0 10px 14px rgba(255,79,163,.18));
    }
    .surpriseWrap.show .note{
      animation: notesFloat 2.4s ease-in-out infinite;
      opacity:1;
    }
    @keyframes notesFloat{
      0%{ transform: translate(0,0) rotate(0deg); }
      50%{ transform: translate(var(--dx), var(--dy)) rotate(8deg); }
      100%{ transform: translate(0,0) rotate(0deg); }
    }

    /* Ring drop (Commitment) */
    .ring{
      position:absolute;
      left:50%;
      top:-60px;
      transform: translateX(-50%);
      font-size:44px;
      opacity:0;
      z-index:4;
      filter: drop-shadow(0 14px 20px rgba(255,210,120,.25));
    }
    .success.legendOn .ring{
      animation: ringDrop .95s ease forwards;
    }
    @keyframes ringDrop{
      0%{ transform: translateX(-50%) translateY(-40px) scale(.85); opacity:0; }
      55%{ opacity:1; }
      70%{ transform: translateX(-50%) translateY(78px) scale(1.02); }
      100%{ transform: translateX(-50%) translateY(62px) scale(1); opacity:1; }
    }

    /* Owner/Admin panel */
    .ownerPanel{
      position:fixed;
      right:14px;
      bottom:14px;
      width:min(320px, calc(100% - 28px));
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,79,163,.22);
      border-radius:18px;
      box-shadow: 0 18px 50px rgba(255,79,163,.22);
      backdrop-filter: blur(10px);
      padding:12px;
      display:none;
      z-index:5000;
      text-align:left;
    }
    .ownerPanel.show{ display:block; }
    .ownerTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .ownerTitle{ font-weight:950; color:#6b2c53; display:flex; align-items:center; gap:8px; }
    .ownerHint{ font-size:12px; color: rgba(107,58,90,.78); margin-top:-6px; margin-bottom:10px; }
    .ownerGrid{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
    .ownerBtn{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,79,163,.20);
      background: linear-gradient(135deg, rgba(255,79,163,.12), rgba(255,119,183,.12));
      color:#5b1630;
      font-weight:900;
      cursor:pointer;
      box-shadow:none;
    }
    .ownerClose{
      border:0;
      background: rgba(255,79,163,.10);
      color:#6b2c53;
      font-weight:950;
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      box-shadow:none;
    }

    @media (max-width:420px){
      button{ width:150px; }
      .btn-zone{ height:210px; }
      .vinylScene{ height:240px; }
      .sleeve{ width:240px; }
      .cards{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="bg" id="bg"></div>
  <div id="tintLayer"></div>

  <div class="wrap">
    <div class="card">
      <div class="ribbon" aria-hidden="true"></div>
      <div class="toast" id="toast">ğŸ™‚</div>

      <h1 id="mainTitle">To the love of my life Sherkima ğŸ’—</h1>
      <div class="question">Will you be my Valentine? ğŸ’˜</div>
      <p class="subtitle">I promise this isnâ€™t a trick questionâ€¦ unless you press No ğŸ˜ğŸ’˜</p>

      <div class="btn-zone" id="btnZone">
        <button type="button" id="yesBtn">Yes <span class="yesHeart">ğŸ’“</span></button>
        <button type="button" id="noBtn">No ğŸ¥º</button>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="success" id="successCard">
      <canvas id="destinyCanvas"></canvas>
      <div class="legendPulse"></div>
      <div class="badge" id="badge"></div>
      <div class="ring">ğŸ’</div>

      <h2 id="yesTitle">You said YESSS ğŸ’–</h2>
      <p id="yesLine">Iâ€™m claiming you as my Valentine. No refunds. No returns. Only love. ğŸ˜ŒğŸŒ¹</p>

      <div id="miniGame">
        <div class="combo" id="comboLine">Combo: x1</div>
        <div class="bar"><div id="timerFill"></div></div>
        <div style="font-weight:900; color:#6b2c53; margin-bottom:8px;">
          Catch the heart ğŸ˜ŒğŸ’˜ <span id="heartScore">0</span>
        </div>
        <div id="heartArena"></div>
        <div style="font-size:12px; color:rgba(107,58,90,.75); margin-top:8px;">
          (It speeds up every time you catch it.)
        </div>
      </div>

      <div id="teaseArea">
        <div style="font-weight:950; color:#6b2c53;">Pick a cardâ€¦ Iâ€™m feeling flirty ğŸ˜ğŸ’˜</div>
        <div class="cards" id="cardGrid"></div>
        <div class="tReveal" id="teaseReveal"></div>
      </div>

      <div class="actions">
        <button type="button" class="btn3" id="surpriseBtn">Press me ğŸ˜ŒğŸ’</button>
        <button type="button" class="btn2" id="replayBtn">Back to Us ğŸ’—</button>
      </div>

      <div class="surpriseWrap" id="surpriseWrap">
        <div class="vinylScene" aria-hidden="true">
          <div class="sleeve">
            <div class="sleeveLabel">Our song ğŸ’</div>
          </div>
          <div class="record"></div>

          <div class="note" style="--dx:18px; --dy:-22px; left: calc(50% + 150px); top: 54px;">ğŸµ</div>
          <div class="note" style="--dx:-18px; --dy:-18px; left: calc(50% + 120px); top: 22px;">ğŸ¶</div>
          <div class="note" style="--dx:22px; --dy:16px; left: calc(50% + 172px); top: 110px;">ğŸ¼</div>
          <div class="note" style="--dx:-14px; --dy:20px; left: calc(50% + 130px); top: 138px;">ğŸµ</div>
        </div>
      </div>
    </div>
  </div>

  <div class="ownerPanel" id="ownerPanel">
    <div class="ownerTop">
      <div class="ownerTitle">ğŸ‘‘ Owner Mode</div>
      <button type="button" class="ownerClose" id="ownerClose">Close</button>
    </div>
    <div class="ownerHint">Tap an ending to <b>force the next YES</b>. Auto-resets after it triggers.</div>

    <div class="ownerGrid">
      <button type="button" class="ownerBtn" data-force="normal">Normal ğŸ’–</button>
      <button type="button" class="ownerBtn" data-force="minigame">Mini-game ğŸ’˜</button>
      <button type="button" class="ownerBtn" data-force="tease">Tease ğŸ˜</button>
      <button type="button" class="ownerBtn" data-force="destiny">Destiny ğŸŒŸ</button>
      <button type="button" class="ownerBtn" data-force="chaos">Chaos ğŸ˜‚</button>
      <button type="button" class="ownerBtn" data-force="commitment">Commitment ğŸ’</button>
    </div>
  </div>

  <audio id="ourSong" src="our-song.mp3"></audio>

  <script>

    document.addEventListener("DOMContentLoaded", () => {
      const bg = document.getElementById("bg");
      const tintLayer = document.getElementById("tintLayer");

      const noBtn = document.getElementById("noBtn");
      const yesBtn = document.getElementById("yesBtn");
      const btnZone = document.getElementById("btnZone");

      const overlay = document.getElementById("overlay");
      const replayBtn = document.getElementById("replayBtn");
      const surpriseBtn = document.getElementById("surpriseBtn");
      const surpriseWrap = document.getElementById("surpriseWrap");

      const toast = document.getElementById("toast");
      const yesTitle = document.getElementById("yesTitle");
      const yesLine = document.getElementById("yesLine");

      const successCard = document.getElementById("successCard");
      const badge = document.getElementById("badge");

      const miniGame = document.getElementById("miniGame");
      const heartArena = document.getElementById("heartArena");
      const heartScoreEl = document.getElementById("heartScore");
      const comboLine = document.getElementById("comboLine");
      const timerFill = document.getElementById("timerFill");

      const teaseArea = document.getElementById("teaseArea");
      const cardGrid = document.getElementById("cardGrid");
      const teaseReveal = document.getElementById("teaseReveal");

      const destinyCanvas = document.getElementById("destinyCanvas");

      const ownerPanel = document.getElementById("ownerPanel");
      const ownerClose = document.getElementById("ownerClose");
      const ownerBtns = Array.from(document.querySelectorAll(".ownerBtn"));

      const mainTitle = document.getElementById("mainTitle");

      if (!bg || !tintLayer || !noBtn || !yesBtn || !btnZone || !overlay || !replayBtn || !surpriseBtn || !surpriseWrap || !toast || !yesTitle || !yesLine || !successCard || !badge || !miniGame || !heartArena || !heartScoreEl || !comboLine || !timerFill || !teaseArea || !cardGrid || !teaseReveal || !destinyCanvas || !ownerPanel || !ownerClose || !mainTitle) return;

      const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
      const zoneRect = () => btnZone.getBoundingClientRect();

      const heartGlyphs = ["ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’•","ğŸ’","â¤ï¸","ğŸ©·"];
      const chaosToasts = ["love.exe crashed ğŸ˜‚","YES detected ğŸ’˜","Cute overload ğŸ˜­","System: blushing ğŸ˜Œ","Warning: too adorable ğŸ©·"];
      const chaosLines = [
        "You just triggered Chaos Modeâ€¦ and Iâ€™m not responsible for what happens next ğŸ˜‚ğŸ’˜",
        "Congrats. You unlocked: *My heart* ğŸ˜ŒğŸ’—",
        "Ok fineâ€¦ you got me. Iâ€™m yours ğŸ’",
        "YES accepted. Valentine secured. ğŸ˜ŒğŸŒ¹",
      ];
      const teaseLines = [
        "You really thought you had a choice? ğŸ˜ğŸ’˜",
        "Now look at youâ€¦ being adorable on purpose ğŸ˜ŒğŸ’•",
        "Good. I like confident Valentines ğŸ˜­ğŸ’—",
        "That YES looked suspiciously bold ğŸ˜ğŸŒ¹",
      ];
      const destinyLines = [
        "It was always you. Always us. ğŸŒŸğŸ’",
        "Some things are writtenâ€¦ like this YES ğŸ˜ŒğŸ’–",
        "Destiny said: stop playing and love each other ğŸ˜­ğŸ’˜",
      ];
      const flirtCompliments = [
        "I love the way you carry yourselfâ€¦ itâ€™s dangerously attractive ğŸ˜ŒğŸ’˜",
        "Youâ€™re my favorite kind of problem ğŸ˜ğŸ’",
        "You have that â€œIâ€™m worth itâ€ energyâ€¦ and you are ğŸ’—",
        "You make me want to be soft and bold at the same time ğŸ˜­ğŸ’˜",
        "If you were a notification, Iâ€™d never swipe you away ğŸ˜ŒğŸ©·",
        "Youâ€™re the reason my standards are unfair now ğŸ˜­ğŸ’"
      ];

      function showToast(text){
        toast.textContent = text;
        toast.classList.add("show");
        clearTimeout(showToast._t);
        showToast._t = setTimeout(()=> toast.classList.remove("show"), 1500);
      }

      function popAt(x,y){
        const el = document.createElement("div");
        el.className = "pop";
        el.textContent = heartGlyphs[Math.floor(Math.random()*heartGlyphs.length)];
        el.style.left = (x + (Math.random()*16-8)) + "px";
        el.style.top  = (y + (Math.random()*16-8)) + "px";
        document.body.appendChild(el);
        setTimeout(()=>el.remove(), 900);
      }

      function spawnBgHeart(){
        const el = document.createElement("div");
        el.className = "float-heart";
        el.textContent = heartGlyphs[Math.floor(Math.random()*heartGlyphs.length)];
        const x = Math.random()*100;
        const s = 0.65 + Math.random()*1.0;
        const drift = (-35 + Math.random()*70) + "vw";
        const dur = 7 + Math.random()*8;
        el.style.setProperty("--x", x + "vw");
        el.style.setProperty("--s", s.toFixed(2));
        el.style.setProperty("--drift", drift);
        el.style.animationDuration = dur + "s";
        bg.appendChild(el);
        setTimeout(() => el.remove(), dur*1000);
      }
      function spawnSparkle(){
        const el = document.createElement("div");
        el.className = "sparkle";
        el.style.setProperty("--x", (Math.random()*100) + "vw");
        el.style.setProperty("--y", (80 + Math.random()*40) + "vh");
        el.style.animationDuration = (3.5 + Math.random()*3.5) + "s";
        bg.appendChild(el);
        setTimeout(()=>el.remove(), 7500);
      }

      setInterval(() => {
        if (overlay.classList.contains("show")) return;
        spawnBgHeart();
        if (Math.random() < 0.60) spawnBgHeart();
        if (Math.random() < 0.55) spawnSparkle();
      }, 520);

      // ---- YES heart beat control ----
      let noPresses = 0;
      let noReturnGraceUntil = 0;

      function updateHeartBeat(){
        const scale = 1.10 + (noPresses * 0.07);
        const speed = Math.max(0.85, 1.8 - (noPresses * 0.20));
        yesBtn.style.setProperty("--beatScale", scale.toFixed(2));
        yesBtn.style.setProperty("--beatSpeed", speed.toFixed(2) + "s");
      }
      function setYesScale(){
        const scale = 1 + (noPresses * 0.08);
        yesBtn.style.setProperty("--yesScale", scale.toFixed(2));
      }
      function setNoOpacity(){
        const op = Math.max(0.12, 1 - (noPresses * 0.22));
        noBtn.style.setProperty("--noOpacity", op.toFixed(2));
      }

      // ---- Smooth NO movement ----
      let noPos = { x: 0, y: 0 };
      let target = { x: 0, y: 0 };
      let animing = false;

      function setTarget(x,y){
        const zr = zoneRect();
        const bw = noBtn.offsetWidth;
        const bh = noBtn.offsetHeight;
        const minX = 10, minY = 10;
        const maxX = zr.width - bw - 10;
        const maxY = zr.height - bh - 10;
        target.x = clamp(x, minX, maxX);
        target.y = clamp(y, minY, maxY);
        if (!animing) smoothStep();
      }

      function smoothStep(){
        animing = true;
        const ease = 0.11;
        noPos.x += (target.x - noPos.x) * ease;
        noPos.y += (target.y - noPos.y) * ease;
        noBtn.style.left = noPos.x + "px";
        noBtn.style.top  = noPos.y + "px";
        const dx = target.x - noPos.x;
        const dy = target.y - noPos.y;
        if (Math.hypot(dx,dy) < 0.6){
          noPos.x = target.x; noPos.y = target.y;
          noBtn.style.left = noPos.x + "px";
          noBtn.style.top  = noPos.y + "px";
          animing = false;
          return;
        }
        requestAnimationFrame(smoothStep);
      }

      function placeNoNextToYes(){
        const zr = zoneRect();
        const yesX = yesBtn.offsetLeft;
        const yesY = yesBtn.offsetTop;
        const gap = 16;

        let startX = yesX + yesBtn.offsetWidth + gap;
        let startY = yesY;

        const bw = noBtn.offsetWidth;
        const bh = noBtn.offsetHeight;

        const minX = 10, minY = 10;
        const maxX = zr.width - bw - 10;
        const maxY = zr.height - bh - 10;

        startX = clamp(startX, minX, maxX);
        startY = clamp(startY, minY, maxY);

        noPos = { x: startX, y: startY };
        target = { x: startX, y: startY };

        noBtn.style.left = startX + "px";
        noBtn.style.top  = startY + "px";
      }

      function evade(pointerX, pointerY){
        if (noPresses >= 4) return;
        if (Date.now() < noReturnGraceUntil) return;

        const zr = zoneRect();
        const px = pointerX - zr.left;
        const py = pointerY - zr.top;

        const maxJump = 120;
        let rx = px + (Math.random()*2-1)*maxJump;
        let ry = py + (Math.random()*2-1)*maxJump;

        const vx = (noPos.x - px);
        const vy = (noPos.y - py);
        const len = Math.hypot(vx,vy) || 1;

        rx += (vx/len) * 55;
        ry += (vy/len) * 55;

        setTarget(rx, ry);
      }

      document.addEventListener("mousemove", (e) => {
        if (overlay.classList.contains("show")) return;
        if (noPresses >= 4) return;
        if (Date.now() < noReturnGraceUntil) return;

        const r = noBtn.getBoundingClientRect();
        const mx = e.clientX, my = e.clientY;
        const dist = Math.hypot((r.left + r.width/2) - mx, (r.top + r.height/2) - my);
        if (dist < 92) evade(mx, my);
      }, { passive:true });

      noBtn.addEventListener("mouseenter", () => {
        if (overlay.classList.contains("show")) return;
        if (noPresses >= 4) return;
        if (Date.now() < noReturnGraceUntil) return;

        const r = noBtn.getBoundingClientRect();
        const x = r.left + r.width/2;
        const y = r.top + r.height/2;
        popAt(x,y);
        evade(x,y);
      });

      noBtn.addEventListener("touchstart", (e) => {
        if (overlay.classList.contains("show")) return;
        if (noPresses >= 4) return;
        if (Date.now() < noReturnGraceUntil) return;

        const t = e.touches && e.touches[0];
        if (!t) return;
        popAt(t.clientX, t.clientY);
        evade(t.clientX, t.clientY);
        e.preventDefault();
      }, { passive:false });

      btnZone.addEventListener("touchmove", (e) => {
        if (overlay.classList.contains("show")) return;
        if (noPresses >= 4) return;
        if (Date.now() < noReturnGraceUntil) return;

        const t = e.touches && e.touches[0];
        if (!t) return;
        evade(t.clientX, t.clientY);
      }, { passive:true });

      const noMessages = [
        "Try again ğŸ˜Œ",
        "Your hand slippedâ€¦ it happens ğŸ˜­ğŸ’—",
        "You pressed No again? Iâ€™m impressed ğŸ˜­ğŸ’",
        "Nice attempt ğŸ˜ŒğŸ’˜",
        "Mhmâ€¦ youâ€™re really committed ğŸ˜‚",
        "I saw that ğŸ‘€ğŸ’•",
        "Youâ€™re adorable, keep trying ğŸ˜ŒğŸ©·",
        "Nopeâ€¦ try again, Valentine ğŸ˜­ğŸŒ¹",
        "That button is fighting for its life ğŸ˜‚ğŸ’—"
      ];

      // ---- Owner/Admin ----
      let forcedEnding = null;

      function openOwner(){
        ownerPanel.classList.add("show");
        showToast("ğŸ‘‘ Owner Mode: choose an ending");
      }
      function closeOwner(){
        ownerPanel.classList.remove("show");
      }

      ownerClose.addEventListener("click", closeOwner);
      ownerBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          forcedEnding = btn.dataset.force || null;
          showToast(`Next YES forced: ${forcedEnding}`);
          closeOwner();
        });
      });

      // Desktop: Ctrl + Shift + O
      document.addEventListener("keydown", (e) => {
        const key = (e.key || "").toLowerCase();
        if (e.ctrlKey && e.shiftKey && key === "o") openOwner();
      });

      // Phone: long-press title (prevents iOS text-select stealing it)
      let lpTimer = null;
      mainTitle.addEventListener("touchstart", (e) => {
        e.preventDefault();
        lpTimer = setTimeout(openOwner, 900);
      }, { passive:false });
      mainTitle.addEventListener("touchend", () => clearTimeout(lpTimer), { passive:true });
      mainTitle.addEventListener("touchcancel", () => clearTimeout(lpTimer), { passive:true });

      // ---- Endings + pity ----
      let pityStacks = 0;
      const PITY_CAP = 0.10;     // 10%
      const BASE_COMMIT = 0.01;  // 1%

      function commitmentChance(){
        const extra = Math.min(pityStacks * 0.01, PITY_CAP - BASE_COMMIT);
        return clamp(BASE_COMMIT + extra, BASE_COMMIT, PITY_CAP);
      }

      function pickEnding(){
        if (forcedEnding){
          const pick = forcedEnding;
          forcedEnding = null;
          return pick;
        }

        const pCommit = commitmentChance();
        const r = Math.random();

        // commitment pCommit
        // chaos 0.05
        // minigame 0.15
        // tease 0.25
        // destiny 0.10
        // normal rest
        let t = 0;
        t += pCommit; if (r < t) return "commitment";
        t += 0.05;   if (r < t) return "chaos";
        t += 0.15;   if (r < t) return "minigame";
        t += 0.25;   if (r < t) return "tease";
        t += 0.10;   if (r < t) return "destiny";
        return "normal";
      }

      function setTint(mode){
        tintLayer.className = "";
        if (!mode) { tintLayer.classList.remove("on"); return; }
        tintLayer.classList.add("on");
        tintLayer.classList.add("mode-" + mode);
      }

      function setBadge(text){
        if (!text){ badge.classList.remove("show"); badge.textContent = ""; return; }
        badge.textContent = text;
        badge.classList.add("show");
      }

      function confettiBurst(count=70){
        for (let i=0;i<count;i++){
          const c = document.createElement("div");
          c.className = "confetti";
          c.style.left = (Math.random()*100) + "vw";
          c.style.animationDuration = (2.4 + Math.random()*2.2) + "s";
          c.style.transform = `rotate(${Math.random()*360}deg)`;
          c.style.background = `hsl(${Math.floor(Math.random()*360)}, 90%, 70%)`;
          document.body.appendChild(c);
          setTimeout(()=>c.remove(), 5200);
        }
      }

      function starBurst(count=40){
        const stars = ["âœ¨","â­","ğŸŒŸ"];
        for (let i=0;i<count;i++){
          const s = document.createElement("div");
          s.className = "star";
          s.textContent = stars[Math.floor(Math.random()*stars.length)];
          s.style.left = (Math.random()*100) + "vw";
          s.style.animationDuration = (2.8 + Math.random()*2.3) + "s";
          document.body.appendChild(s);
          setTimeout(()=>s.remove(), 5600);
        }
      }

      function goldRise(count=90){
        for (let i=0;i<count;i++){
          const g = document.createElement("div");
          g.className = "gold";
          g.style.left = (Math.random()*100) + "vw";
          g.style.setProperty("--dx", (Math.random()*120 - 60) + "px");
          g.style.setProperty("--s", (0.7 + Math.random()*1.4).toFixed(2));
          g.style.animationDuration = (2.6 + Math.random()*2.4) + "s";
          document.body.appendChild(g);
          setTimeout(()=>g.remove(), 6000);
        }
      }

      function emojiRain(count=40){
        const em = ["ğŸ’˜","ğŸ’—","ğŸ˜Œ","ğŸ˜‚","ğŸ©·","ğŸ’","ğŸŒ¹"];
        for (let i=0;i<count;i++){
          const e = document.createElement("div");
          e.className = "emojiRain";
          e.textContent = em[Math.floor(Math.random()*em.length)];
          e.style.left = (Math.random()*100) + "vw";
          e.style.animationDuration = (2.0 + Math.random()*2.2) + "s";
          document.body.appendChild(e);
          setTimeout(()=>e.remove(), 5200);
        }
      }

      function chaosSpam(){
        let n = 0;
        const id = setInterval(() => {
          showToast(chaosToasts[Math.floor(Math.random()*chaosToasts.length)]);
          n++;
          if (n >= 6) clearInterval(id);
        }, 420);
      }

      function playCommitChime(){
        try{
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const now = ctx.currentTime;

          function tone(freq, start, dur){
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = "sine";
            o.frequency.value = freq;
            g.gain.setValueAtTime(0.0001, start);
            g.gain.exponentialRampToValueAtTime(0.25, start + 0.02);
            g.gain.exponentialRampToValueAtTime(0.0001, start + dur);
            o.connect(g); g.connect(ctx.destination);
            o.start(start); o.stop(start + dur + 0.02);
          }
          tone(659.25, now, 0.18);
          tone(783.99, now+0.18, 0.18);
          tone(987.77, now+0.36, 0.28);
          setTimeout(()=>ctx.close(), 1200);
        } catch(_) {}
      }

      function resetOverlayUI(){
        document.body.classList.remove("legendary");
        successCard.classList.remove("legendOn","destinyOn");
        successCard.classList.remove("shake");
        setTint(null);
        setBadge(null);
        miniGame.style.display = "none";
        teaseArea.style.display = "none";
        cardGrid.innerHTML = "";
        teaseReveal.textContent = "";
        heartArena.innerHTML = "";
        heartScoreEl.textContent = "0";
        comboLine.textContent = "Combo: x1";
        timerFill.style.transform = "scaleX(1)";
        surpriseWrap.classList.remove("show");
        stopDestiny();
      }

      // ---- Destiny Canvas Heart ----
      let dCtx = null, dRAF = null, dW=0, dH=0;
      let dStars = [];

      function resizeDestiny(){
        const r = successCard.getBoundingClientRect();
        dW = Math.max(300, Math.floor(r.width + 40));
        dH = Math.max(260, Math.floor(r.height + 40));
        destinyCanvas.width = dW;
        destinyCanvas.height = dH;
        dCtx = destinyCanvas.getContext("2d");
      }

      function heartPoint(t){
        // classic parametric heart
        const x = 16 * Math.pow(Math.sin(t), 3);
        const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
        return {x, y};
      }

      function startDestiny(){
        resizeDestiny();
        dStars = [];
        const count = 160;

        for (let i=0;i<count;i++){
          const t = (i / count) * Math.PI * 2;
          const p = heartPoint(t);
          // normalize to canvas
          const cx = dW/2 + p.x * (dW/55);
          const cy = dH/2 - p.y * (dH/55);
          dStars.push({
            x: cx + (Math.random()*6-3),
            y: cy + (Math.random()*6-3),
            r: 0.8 + Math.random()*1.8,
            a: 0.25 + Math.random()*0.55,
            tw: 0.015 + Math.random()*0.03
          });
        }
        animateDestiny();
      }

      function animateDestiny(){
        if (!dCtx) return;
        dCtx.clearRect(0,0,dW,dH);

        // soft glow behind
        const g = dCtx.createRadialGradient(dW/2, dH/2, 20, dW/2, dH/2, Math.min(dW,dH)/1.2);
        g.addColorStop(0, "rgba(255,255,255,0.15)");
        g.addColorStop(1, "rgba(255,255,255,0)");
        dCtx.fillStyle = g;
        dCtx.fillRect(0,0,dW,dH);

        for (const s of dStars){
          s.a += (Math.random()*2-1) * s.tw;
          s.a = clamp(s.a, 0.15, 0.85);
          dCtx.beginPath();
          dCtx.fillStyle = `rgba(255,255,255,${s.a})`;
          dCtx.arc(s.x, s.y, s.r, 0, Math.PI*2);
          dCtx.fill();
        }
        dRAF = requestAnimationFrame(animateDestiny);
      }

      function stopDestiny(){
        if (dRAF) cancelAnimationFrame(dRAF);
        dRAF = null;
        dStars = [];
        if (dCtx) dCtx.clearRect(0,0,dW,dH);
      }

      window.addEventListener("resize", () => {
        if (successCard.classList.contains("destinyOn")) startDestiny();
      });

      // ---- Mini-game (chase heart) ----
      let gameScore = 0;
      let heartTTL = 1100;
      let lastCatchAt = 0;
      let misses = 0;
      let ttlTimer = null;

      function setTimer(p){
        timerFill.style.transform = `scaleX(${clamp(p,0,1)})`;
      }

      function startMiniGame(){
        gameScore = 0;
        heartTTL = 1100;
        misses = 0;
        lastCatchAt = 0;
        heartScoreEl.textContent = "0";
        comboLine.textContent = "Combo: x1";
        miniGame.style.display = "block";
        yesLine.textContent = "Mini challenge: catch 5 hearts ğŸ˜ŒğŸ’˜ (it gets faster)";
        spawnGameHeart();
      }

      function spawnGameHeart(easy=false){
        heartArena.innerHTML = "";

        const h = document.createElement("div");
        h.className = "gameHeart";
        h.textContent = "ğŸ’—";

        const arena = heartArena.getBoundingClientRect();
        const pad = 18;
        const maxX = Math.max(0, arena.width - pad*2);
        const maxY = Math.max(0, arena.height - pad*2);

        h.style.left = (pad + Math.random()*maxX) + "px";
        h.style.top  = (pad + Math.random()*maxY) + "px";

        heartArena.appendChild(h);

        const ttl = easy ? 1400 : heartTTL;
        const start = performance.now();
        setTimer(1);

        clearInterval(ttlTimer);
        ttlTimer = setInterval(() => {
          const p = 1 - ((performance.now() - start) / ttl);
          setTimer(p);
        }, 30);

        let gone = false;
        const kill = setTimeout(() => {
          if (gone) return;
          gone = true;
          h.classList.add("vanish");
          misses++;
          showToast(misses >= 3 ? "Ok okâ€¦ Iâ€™ll be nice ğŸ˜­ğŸ’—" : "Oopâ€”too slow ğŸ˜­");
          clearInterval(ttlTimer);

          // If missed too much, spawn an easy heart so she never gets stuck
          setTimeout(() => spawnGameHeart(misses >= 3), 240);
        }, ttl);

        function teleport(){
          if (gone) return;
          // little jumps to keep it fun
          if (Math.random() < 0.35 && gameScore < 5){
            h.style.left = (pad + Math.random()*maxX) + "px";
            h.style.top  = (pad + Math.random()*maxY) + "px";
          }
        }
        const tp = setInterval(teleport, 260);

        h.addEventListener("click", () => {
          if (gone) return;
          gone = true;
          clearTimeout(kill);
          clearInterval(tp);
          clearInterval(ttlTimer);

          const now = Date.now();
          const combo = (now - lastCatchAt) < 900 ? 2 : 1;
          lastCatchAt = now;

          gameScore += 1;
          heartScoreEl.textContent = String(gameScore);
          comboLine.textContent = `Combo: x${combo}`;

          // speeds up hard, but stays playable
          heartTTL = Math.max(520, Math.floor(heartTTL * 0.88));

          h.classList.add("vanish");

          if (gameScore >= 5){
            showToast("Okay okayâ€¦ you win ğŸ˜ŒğŸ’");
            yesLine.textContent = "You beat the mini game ğŸ˜­ğŸ’– Now press â€œPress me ğŸ˜ŒğŸ’â€ for your surprise.";
            setTimer(0);
            heartArena.innerHTML = "";
            return;
          }
          setTimeout(() => spawnGameHeart(false), 220);
        });
      }

      // ---- Tease cards ----
      function startTease(){
        teaseArea.style.display = "block";
        teaseReveal.textContent = "";
        cardGrid.innerHTML = "";

        // pick one real compliment index
        const answer = Math.floor(Math.random()*3);
        const picks = [];
        while (picks.length < 3){
          const c = flirtCompliments[Math.floor(Math.random()*flirtCompliments.length)];
          if (!picks.includes(c)) picks.push(c);
        }

        for (let i=0;i<3;i++){
          const b = document.createElement("button");
          b.type = "button";
          b.className = "tCard";
          b.textContent = ["A","B","C"][i] + " ğŸ’Œ";
          b.addEventListener("click", () => {
            teaseReveal.textContent = picks[i];
            showToast(i === answer ? "Good choice ğŸ˜ğŸ’˜" : "Still cute though ğŸ˜­ğŸ’—");
            confettiBurst(25);
          });
          cardGrid.appendChild(b);
        }
      }

      // ---- NO click (fade at 4 + 30% return) ----
      noBtn.addEventListener("click", (e) => {
        const x = e.clientX || (window.innerWidth/2);
        const y = e.clientY || (window.innerHeight/2);
        popAt(x,y);

        if (noPresses >= 4) return;

        noPresses++;
        setYesScale();
        setNoOpacity();
        updateHeartBeat();

        if (noPresses === 4){
          showToast("Plot Twist: No has left to find its own Valentine ğŸ’˜");
          noBtn.style.pointerEvents = "none";

          setTarget(target.x + 140, target.y - 80);
          setTimeout(() => { noBtn.style.opacity = "0"; }, 380);

          setTimeout(() => {
            if (Math.random() < 0.30) {
              const returnMessages = [
                "Plot Twist: No failed to find a Valentineâ€¦ and came back ğŸ¥ºğŸ’—",
                "No realized the streets are cold and returned immediately ğŸ¥¶ğŸ’",
                "No tried to leaveâ€¦ but missed you already ğŸ˜ŒğŸ’•",
                "No went out thereâ€¦ and panicked. So it came back ğŸ˜­ğŸ’˜",
                "No said \"nevermind\" and spawned back in ğŸ˜­ğŸŒ¹"
              ];
              showToast(returnMessages[Math.floor(Math.random()*returnMessages.length)]);

              noPresses = 3;
              noBtn.style.opacity = "1";
              noBtn.style.pointerEvents = "auto";

              noReturnGraceUntil = Date.now() + 700;

              setNoOpacity();
              updateHeartBeat();
              placeNoNextToYes();
            }
          }, 1400);

          return;
        }

        showToast(noMessages[(noPresses - 1) % noMessages.length]);
        setTimeout(() => evade(x,y), 120);
      });

      // ---- YES click -> pick ending ----
      yesBtn.addEventListener("click", (e) => {
        popAt(e.clientX || window.innerWidth/2, e.clientY || window.innerHeight/2);

        overlay.classList.add("show");
        resetOverlayUI();

        const ending = pickEnding();

        // pity only when not forced
        if (!forcedEnding){
          if (ending === "commitment") pityStacks = 0;
          else pityStacks = clamp(pityStacks + 1, 0, 20);
        }

        if (noPresses === 0){
          yesTitle.textContent = "Awww you pressed it on the first try ğŸ˜­ğŸ’–";
        } else {
          yesTitle.textContent = "You said YESSS ğŸ’–";
        }

        // default
        surpriseBtn.textContent = "Press me ğŸ˜ŒğŸ’";

        if (ending === "normal"){
          setTint(null);
          setBadge(null);
          yesLine.textContent = "Iâ€™m claiming you as my Valentine. No refunds. No returns. Only love. ğŸ˜ŒğŸŒ¹";
          confettiBurst(55);
        }

        if (ending === "chaos"){
          setTint("chaos");
          setBadge("ğŸ˜‚ CHAOS MODE");
          yesLine.textContent = chaosLines[Math.floor(Math.random()*chaosLines.length)];
          successCard.classList.add("shake");
          confettiBurst(80);
          emojiRain(42);
          chaosSpam();
        }

        if (ending === "tease"){
          setTint("tease");
          setBadge("ğŸ˜ TEASE MODE");
          yesLine.textContent = teaseLines[Math.floor(Math.random()*teaseLines.length)];
          startTease();
          confettiBurst(45);
          surpriseBtn.textContent = "Come closer ğŸ˜Œ";
        }

        if (ending === "destiny"){
          setTint("destiny");
          setBadge("ğŸŒŸ DESTINY");
          yesLine.textContent = destinyLines[Math.floor(Math.random()*destinyLines.length)];
          successCard.classList.add("destinyOn");
          startDestiny();
          starBurst(60);
          confettiBurst(45);
        }

        if (ending === "minigame"){
          setTint("minigame");
          setBadge("ğŸ’˜ MINI-GAME");
          confettiBurst(35);
          startMiniGame();
        }

        if (ending === "commitment"){
          setTint("commitment");
          setBadge("ğŸ’ LEGENDARY PULL");
          document.body.classList.add("legendary");
          successCard.classList.add("legendOn");

          yesTitle.textContent = "ğŸ’ The Commitment Ending ğŸ’";
          yesLine.textContent = "You just pulled the legendary endingâ€¦ so yeah. Youâ€™re stuck with me ğŸ˜ŒğŸ’›";

          playCommitChime();
          confettiBurst(130);
          starBurst(85);
          goldRise(130);
        }
      });

      // Surprise button
      surpriseBtn.addEventListener("click", () => {
        surpriseWrap.classList.add("show");
        showToast("Okayyyâ€¦ hereâ€™s the surprise ğŸ˜ŒğŸ¶");
      });

      // Back to main
      replayBtn.addEventListener("click", () => {
        overlay.classList.remove("show");

        noPresses = 0;
        noReturnGraceUntil = 0;

        yesBtn.style.setProperty("--yesScale", "1");
        noBtn.style.setProperty("--noOpacity", "1");

        noBtn.style.opacity = "1";
        noBtn.style.pointerEvents = "auto";

        resetOverlayUI();
        updateHeartBeat();
        setTimeout(placeNoNextToYes, 0);
      });

      // Init
      updateHeartBeat();
      setTimeout(placeNoNextToYes, 0);
      window.addEventListener("resize", () => setTimeout(placeNoNextToYes, 0));

    });
  </script>
</body>
</html>
